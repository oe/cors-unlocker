var y=Object.defineProperty,b=(e,t,n)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,E=(e,t,n)=>b(e,t+"",n);const x="https://cors.forth.ink/message/index.html",f={chrome:"knhlkjdfmgkmelcjfnbbhpphkmjjacng",firefox:"cors-unlocker@forth.ink",edge:"knhlkjdfmgkmelcjfnbbhpphkmjjacng"},h=/firefox/i.test(navigator.userAgent),w=/edg/i.test(navigator.userAgent);function k(){return h?f.firefox:w?f.edge:f.chrome}const p=k();class l extends Error{constructor(t){super(t.message),E(this,"type"),this.type=t.type,this.name="AppCorsError"}}let u=null,c=null,a=null;function v(){return u&&(!a||a.isConnected)||(u=new Promise((e,t)=>{a=document.createElement("iframe"),a.src=`${x}?origin=${encodeURIComponent(location.origin)}&extID=${encodeURIComponent(p)}`,a.style.display="none",a.className="cors-unlocker-frame";const n=()=>{window.removeEventListener("message",o),clearTimeout(m)},o=i=>{i.source!==a.contentWindow||!i.data||i.data.type!=="from-page"||i.data.method!=="init"||(c=a.contentWindow,n(),e(a))},m=setTimeout(()=>{n(),t(new l({type:"communication-failed",message:"Frame initialization timeout - extension may not be installed or may not have permission to communicate with this origin"}))},1e4);window.addEventListener("message",o),a.onerror=()=>{n(),t(new l({type:"communication-failed",message:"Frame failed to load"}))},document.body.appendChild(a)})),u}let g=!1;const r={};function j(){g||(g=!0,window.addEventListener("message",e=>{const t=e.data;if(e.source!==c||!t)return;const n=r[t.id];if(!n)return;const[o,m,i]=n;delete r[t.id],i&&clearTimeout(i),t.error?m(new l({type:t.error.type,message:t.error.message})):o(t.data)}))}async function d(e){try{await v()}catch(t){throw u=null,c=null,t}return new Promise((t,n)=>{if(!c){n(new l({type:"communication-failed",message:"Frame window is not ready"}));return}const o=Math.random().toString(36).slice(2),m={id:o,...e,type:"from-npm"};j();let i=null;e.method!=="enable"&&(i=setTimeout(()=>{r[o]&&(delete r[o],n(new l({type:"communication-failed",message:`Message timeout: ${e.method}`})))},5e3)),r[o]=[s=>t(s),s=>n(s),i];try{c.postMessage(m,"*")}catch{const s=r[o];s&&(s[2]&&clearTimeout(s[2]),delete r[o]),u=null,c=null,n(new l({type:"communication-failed",message:"Failed to send message to frame"}))}})}function C(){return d({method:"isInstalled"})}async function I(){await d({method:"openOptions"})}function F(){let e;h?e="https://addons.mozilla.org/en-US/firefox/addon/cors-unlocker/":w?e=`https://microsoftedge.microsoft.com/addons/detail/${p}`:e=`https://chromewebstore.google.com/detail/${p}`,window.open(e,"_blank")}async function T(){try{return await d({method:"isEnabled"})}catch(e){if(e instanceof l&&e.type==="not-installed")return{enabled:!1,credentials:!1};throw e}}async function $(){return await d({method:"getExtConfig"})}async function A(e){let t=e;if(!e||typeof e.credentials>"u")try{const n=await $();t={...e,credentials:n.dftEnableCredentials}}catch(n){console.warn("Failed to get extension config, using provided options:",n)}return await d({method:"enable",payload:t})}async function O(){await d({method:"disable"})}const P={isExtInstalled:C,openExtOptions:I,openStorePage:F,isEnabled:T,enable:A,disable:O};export{l as AppCorsError,P as default,O as disable,A as enable,T as isEnabled,C as isExtInstalled,I as openExtOptions,F as openStorePage};
