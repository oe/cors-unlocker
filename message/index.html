<!DOCTYPE html><html> <head><meta name="robots" content="noindex"><title>Extension Messaging frame</title><script type="module">const a=typeof chrome<"u"?chrome:typeof browser<"u"?browser:null;parent===window?document.body.innerHTML="<p>This page is intended to be embedded for internal communication.</p>":parent.postMessage({type:"ext",method:"init"},"*");const s=(()=>{const e=new URLSearchParams(location.search);return{extID:e.get("extID"),origin:e.get("origin")}})();let o=null;const u=()=>{o&&(console.warn("disconnect port"),o.disconnect(),o=null)},g={isInstalled:async e=>{if(!(!!a&&!!a.runtime)){if(e?.throw)throw{type:"not-installed",message:"browser extension API not available"};return!1}if(!s.extID){if(e?.throw)throw{type:"config-error",message:"extID not provided"};return!1}try{return await new Promise((n,i)=>{a.runtime.sendMessage(s.extID,{method:"ping",payload:{}},r=>{if(a.runtime.lastError){i(new Error(a.runtime.lastError.message||"Extension communication failed"));return}n()}),setTimeout(()=>{i(new Error("Extension communication timeout"))},2e3)}),!0}catch(n){if(console.warn("Extension verification failed:",n),e?.throw)throw{type:"not-installed",message:`extension with ID ${s.extID} not installed or not responding`};return!1}},enable:async e=>{const t=await c("getRule");if(console.log("rule",t),t&&!t.disabled){if(!e||typeof e.credentials>"u")return{success:!0};if(t.credentials===e.credentials)return{success:!0}}if(!t||t.disabled||!t.credentials&&e?.credentials){let n="";if(!t||t.disabled?(n=`Current page("${s.origin}") is requesting to enable CORS`,e?(e.credentials?n+=" with credentials.":n+=".",e.reason&&(n+=`
Message from current Page:

${e.reason}

`)):n+=`

`,n+=`Please only enable CORS if you trust the current page.
Do you want to enable CORS?`):(n="Current page is requesting to enable CORS with credentials.",e?.reason?n+=`
Message from current Page:

${e.reason}

`:n+=`

`,n+="Please only enable CORS with credentials if you trust the current page. Do you want to continue?"),!confirm(n))throw{type:"user-cancel",message:"User canceled"}}return c("enable",e)},toggleChangeListener:async e=>{u(),e?.enabled&&(o=a.runtime.connect(s.extID),o.onDisconnect.addListener(u),o.onMessage.addListener(t=>{d({id:Math.random().toString(36).slice(2),type:"onChange",data:t})}))}};window.addEventListener("message",async e=>{const t=e.data;if(console.log("frame message",t),!f(t)||t.type!=="ext")return;const{method:n,payload:i}=t;try{const r=g[n];if(n!=="isInstalled"&&await g.isInstalled({throw:!0}),!s.extID||!s.origin)throw{type:"config-error",message:"extID or origin not provided"};try{new URL(s.origin)}catch{throw{type:"invalid-origin",message:"invalid origin"}}let l;r?l=await r(i):l=await c(t.method,t.payload),d({id:t.id,type:"response",data:l})}catch(r){d({id:t.id,type:"response",error:r&&typeof r=="object"?r:{message:r,type:"inner-error"}})}});function c(e,t){return new Promise((n,i)=>{a.runtime.sendMessage(s.extID,{method:e,payload:{...t,origin:s.origin}},r=>{if(console.log("ext response",r),r&&typeof r=="object"&&r.__mozWebExtensionPolyfillReject__)try{return i(JSON.parse(r.message))}catch{return i(r.message)}n(r)})})}function f(e){return e&&e.type&&e.id&&e.method}function d(e){parent.postMessage(e,"*")}</script></head> </html>